<div class="header-section">
    <h1>Export Data</h1>
    <p>Select an export mode and customize your data download.</p>
</div>

<!-- Export Mode Navigation -->
<div class="export-nav">
    <button class="nav-btn active" data-mode="urls">Export URLs</button>
    <button class="nav-btn" data-mode="users">Export Users</button>
    <button class="nav-btn" data-mode="thumbnails">Export Thumbnails</button>
    <button class="nav-btn" data-mode="db">Export DB</button>
    <button class="nav-btn" data-mode="csv">Export CSV</button>
</div>

<div class="export-grid" style="margin-top: 20px;">

    <!-- Dynamic Filter Card -->
    <div class="modern-card">
        <div class="card-header">
            <h3 id="export-mode-title">Export Settings</h3>
        </div>
        <div class="card-body">

            <!-- Global Filters (Always Visible or Contextual?) -->
            <!-- We will toggle visibility of specific groups based on mode -->

            <div class="filter-flex">

                <!-- Platform Filter -->
                <div class="filter-group" id="group-platform">
                    <label>Platform</label>
                    <select id="export-platform" class="modern-select">
                        <option value="ALL">All Platforms</option>
                        <option value="TikTok">TikTok</option>
                        <option value="Facebook">Facebook</option>
                        <option value="Instagram">Instagram</option>
                    </select>
                </div>

                <!-- User Filter -->
                <div class="filter-group" id="group-user">
                    <label>User</label>
                    <select id="export-user" class="modern-select">
                        <option value="ALL">All Users</option>
                    </select>
                </div>

                <!-- Only New Filter (Restored) -->
                <div class="filter-group" id="group-new-only"
                    style="flex: 0 0 auto; display: flex; flex-direction: column;">
                    <label>New Items Only</label>
                    <div class="toggle-row">
                        <label class="toggle-switch">
                            <input type="checkbox" id="export-new-only">
                            <span class="slider"></span>
                        </label>
                        <span style="font-size: 0.85rem; color: #fff;">Yes</span>
                    </div>
                    <label
                        style="display: flex; align-items: center; gap: 6px; font-size: 0.8rem; color: #aaa; margin-top: 5px; cursor: pointer;">
                        <input type="checkbox" id="export-new-only-global" style="accent-color: #00f2ea;">
                        <span>Apply to all modes</span>
                    </label>
                </div>

                <!-- Date Range Filter -->
                <div class="filter-group" id="group-date" style="flex: 1.5;">
                    <label>Scraped Date Range</label>
                    <div class="date-range-wrapper">
                        <input type="date" id="export-date-start" class="modern-input">
                        <span class="date-separator">to</span>
                        <input type="date" id="export-date-end" class="modern-input">
                    </div>
                </div>

            </div>

            <!-- Specific Options Container -->
            <div id="mode-specific-options" style="margin-top: 15px; border-top: 1px solid #333; padding-top: 15px;">

                <!-- Thumbnails Options -->
                <div id="opt-thumbnails" style="display: none;">
                    <label style="display:block; margin-bottom: 8px; color: #b3b3b3; font-weight: 500;">Zip
                        Strategy</label>

                    <div class="zip-strategy-toggle">
                        <div class="toggle-option active" data-value="batch" id="opt-batch-btn">
                            <i class="fas fa-layer-group"></i> By Batch (Count)
                        </div>
                        <div class="toggle-option" data-value="size" id="opt-size-btn">
                            <i class="fas fa-weight-hanging"></i> By Size (MB)
                        </div>
                    </div>
                    <input type="hidden" id="zip-strategy-value" value="batch">

                    <div id="zip-batch-settings" class="mt-3">
                        <label>Max Items per Zip</label>
                        <input type="number" id="zip-max-items" class="modern-input" value="2000">
                    </div>
                    <div id="zip-size-settings" class="mt-3" style="display: none;">
                        <label>Max MB per Zip</label>
                        <input type="number" id="zip-max-size" class="modern-input" value="500">
                    </div>
                </div>

                <!-- DB Options -->
                <div id="opt-db" style="display: none;">
                    <label>Export Type</label>
                    <select id="db-export-type" class="modern-select">
                        <option value="snapshot">Snapshot (ZIP)</option>
                        <option value="full">Metadata Only (JSON)</option>
                        <option value="single">Single Store</option>
                    </select>

                    <!-- Incremental Info / Force Full Option -->
                    <div id="db-snapshot-options" style="margin-top: 15px; padding: 10px; background: rgba(0, 242, 234, 0.05); border-radius: 6px; border: 1px solid rgba(0, 242, 234, 0.2);">
                        <div style="font-size: 0.85rem; color: #aaa; margin-bottom: 8px;">
                            Last Snapshot: <span id="last-snapshot-time" style="color: #fff; font-weight: bold;">Never</span>
                        </div>
                        
                        <label class="toggle-switch">
                            <input type="checkbox" id="db-force-full-snapshot">
                            <span class="slider"></span>
                        </label>
                        <span style="margin-left: 10px; color: #e0e0e0; font-size: 0.9rem;">Force Full Backup</span>
                        <div style="font-size: 0.75rem; color: #888; margin-top: 4px; margin-left: 44px;">
                            Ignore last snapshot time and export everything.
                        </div>
                    </div>

                    <div id="db-store-select" style="display: none; margin-top: 10px;">
                        <label>Select Store</label>
                        <select id="db-target-store" class="modern-select">
                            <option value="media">Media</option>
                            <option value="thumbnails">Thumbnails</option>
                        </select>
                    </div>

                    <div id="db-include-thumbs-wrapper" style="margin-top: 15px; display: none;">
                         <label class="toggle-switch">
                            <input type="checkbox" id="db-include-thumbnails">
                            <span class="slider"></span>
                        </label>
                        <span style="margin-left: 10px; color: #666;">Include Thumbnails (ZIP)</span>
                    </div>
                </div>

                <!-- CSV Options -->
                <div id="opt-csv" style="display: none;">
                    <div class="pills-container" id="column-pills">
                        <label class="pill-checkbox"><input type="checkbox" value="originalUrl" checked><span
                                class="pill-label">Video URL</span></label>
                        <label class="pill-checkbox"><input type="checkbox" value="scrapedAt" checked><span
                                class="pill-label">Date Scraped</span></label>
                        <label class="pill-checkbox"><input type="checkbox" value="userId" checked><span
                                class="pill-label">Username</span></label>
                        <label class="pill-checkbox"><input type="checkbox" value="platform" checked><span
                                class="pill-label">Platform</span></label>
                        <label class="pill-checkbox"><input type="checkbox" value="videoId" checked><span
                                class="pill-label">Video ID</span></label>
                        <label class="pill-checkbox"><input type="checkbox" value="thumbnailUrl"><span
                                class="pill-label">Thumbnail URL</span></label>
                    </div>
                </div>

                <!-- Common Checkboxes -->
                <div style="margin-top: 15px;">
                    <label class="toggle-switch">
                        <input type="checkbox" id="export-favorite-only" disabled>
                        <span class="slider"></span>
                    </label>
                    <span style="margin-left: 10px; color: #666;">Export Favorites Only (Coming Soon)</span>
                </div>

            </div>

            <!-- Primary Action Button -->
            <div style="margin-top: 25px;">
                <button id="btn-run-export" class="btn-primary-large" style="width: 100%;">
                    <span class="icon">â¬‡</span> <span id="btn-export-text">Export URLs (TXT)</span>
                </button>
                <div id="export-progress" style="display: none; margin-top: 10px; color: #00f2ea;">
                    Processing... 0%
                </div>
            </div>

        </div>
    </div>

    <!-- Live Preview (Contextual) -->
    <div class="modern-card" id="export-preview-card">
        <div class="card-header">
            <h3>Preview</h3>
        </div>
        <div class="card-body table-wrapper">
            <div id="preview-placeholder" style="padding: 20px; text-align: center; color: #666;">
                Select filters to see preview
            </div>
            <table id="preview-table" class="modern-table" style="display: none;">
                <thead></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

</div>

<style>
    /* Tab Navigation Styles */
    .export-nav {
        display: flex;
        gap: 10px;
        border-bottom: 2px solid #333;
        padding-bottom: 0;
        margin-bottom: 20px;
    }

    .nav-btn {
        background: none;
        border: none;
        color: #888;
        padding: 10px 20px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 500;
        transition: all 0.2s;
        border-bottom: 2px solid transparent;
        margin-bottom: -2px;
    }

    .nav-btn:hover {
        color: #fff;
    }

    .nav-btn.active {
        color: #00f2ea;
        border-bottom: 2px solid #00f2ea;
    }

    .filter-flex {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        align-items: flex-end;
    }

    .filter-group {
        flex: 1;
        min-width: 200px;
    }
</style>